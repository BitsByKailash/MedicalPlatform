<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Doctor Appointment Calendar</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; }
    .calendar-nav { background-color: #ffffff; border-bottom: 1px solid #dee2e6; padding: 1rem; display: flex; justify-content: space-between; align-items: center; }
    .calendar-grid { visibility: hidden; opacity: 0; transform: translateY(10px); transition: opacity 0.5s ease, transform 0.5s ease, visibility 0.5s; height: 0; overflow: hidden; }
    .calendar-grid.active { visibility: visible; opacity: 1; transform: translateY(0); height: auto; overflow: visible; }
    #week.calendar-grid { display: grid; grid-template-columns: repeat(8, 1fr); grid-auto-rows: 80px; }
    #month.calendar-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    #year.calendar-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
    .calendar-grid div { border: 1px solid #dee2e6; padding: 5px; background-color: white; position: relative; }
    .day-header { background-color: #e9ecef; font-weight: bold; text-align: center; }
    .appointment { position: relative; background-color: #0d6efd; color: white; padding: 4px; font-size: 0.8rem; border-radius: 5px; margin-top: 4px; }
    .appointment:hover { background-color: #084298; cursor: pointer; }
    @media (max-width: 768px) { #month.calendar-grid, #year.calendar-grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="calendar-nav">
    <h4>Doctor's Appointment Calendar</h4>
    <div class="btn-group" role="group" aria-label="Calendar Views">
      <button type="button" class="btn btn-outline-primary" onclick="showView('week')">Week</button>
      <button type="button" class="btn btn-outline-primary" onclick="showView('month')">Month</button>
      <button type="button" class="btn btn-outline-primary" onclick="showView('year')">Year</button>
      <button type="button" class="btn btn-outline-primary" onclick="showView('list')">List</button>
    </div>
  </div>

  <div class="container-fluid mt-3">
    <div id="week" class="calendar-grid active">
      <div></div>
      <div class="day-header">Monday</div>
      <div class="day-header">Tuesday</div>
      <div class="day-header">Wednesday</div>
      <div class="day-header">Thursday</div>
      <div class="day-header">Friday</div>
      <div class="day-header">Saturday</div>
      <div class="day-header">Sunday</div>
      <% for(let hour = 9; hour <= 17; hour++) { %>
        <div class="day-header"><%= hour %>:00</div>
        <% ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'].forEach(day => { %>
          <div>
            <% appointmentList.forEach(app => 
            { 
                const appDate = new Date(app.appointment_date);
                const appDay = appDate.toLocaleString('en-US', { weekday: 'long' });
                const appHour = app.appointment_time.split(':')[0];
                const appMonth = appDate.getMonth();
                const appYear = appDate.getFullYear();
                if(appDay === day && appHour === hour) { %>
                <div class="appointment <%= app.className || 'default-appointment-style' %>"><%= app.patientname %><br><%= app.appointment_time %></div>
            <% } }); %>
          </div>
        <% }); %>
      <% } %>
    </div>

    <div id="month" class="calendar-grid"></div>

    <div id="year" class="calendar-grid">
      <div class="day-header" style="grid-column: span 4; text-align: center;">
        <button onclick="changeYear(-1)" class="btn btn-sm btn-outline-secondary">&lt;</button>
        <span id="yearLabel">2025</span>
        <button onclick="changeYear(1)" class="btn btn-sm btn-outline-secondary">&gt;</button>
      </div>
    </div>

    <div id="list" class="calendar-grid">
      <div class="day-header" style="grid-column: span 8; text-align: center;">[List View Placeholder]</div>
      <% appointmentList.forEach(app => { %>
        <div class="appointment <%= app.className || 'default-appointment-style' %>"><%= app.patientname %> â€” <%= app.day %>, <%= app.appointment_time %></div>      <% }); %>
    </div>
  </div>

  <script>
    let currentYear = new Date().getFullYear();
    const appointments = JSON.parse("<%= JSON.stringify(appointmentList) %>");
    console.log(appointments);
    function showView(viewId) {
      const views = ['week', 'month', 'year', 'list'];
      views.forEach(id => document.getElementById(id)?.classList.remove('active'));
      document.getElementById(viewId)?.classList.add('active');

      if (viewId === 'month') renderMonthView(currentYear);
      if (viewId === 'year') renderYearView();
    }

    function changeYear(offset) {
      currentYear += offset;
      document.getElementById('yearLabel').textContent = currentYear;
      renderYearView();
      renderMonthView(currentYear);
    }

    function renderMonthView(year) {
      const monthGrid = document.getElementById('month');
      monthGrid.innerHTML = '';
      const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

      for (let i = 0; i < 12; i++) {
        const monthDiv = document.createElement('div');
        const monthName = monthNames[i];
        let content = `<div class='day-header'>${monthName} ${year}</div>`;
        appointments.forEach(app => {
          if (appMonth === i && appYear === year) {
            const cls = app.className || 'default-appointment-style';
            content += `<div class='appointment ${cls}'>${app.patientname}<br>${app.day}, ${app.appointment_time}</div>`;
          }
        });
        monthDiv.innerHTML = content;
        monthGrid.appendChild(monthDiv);
      }
    }

    function renderYearView() {
      const yearGrid = document.getElementById('year');
      const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
      yearGrid.innerHTML = `<div class='day-header' style='grid-column: span 4; text-align: center;'>
        <button onclick='changeYear(-1)' class='btn btn-sm btn-outline-secondary'>&lt;</button>
        <span id='yearLabel'>${currentYear}</span>
        <button onclick='changeYear(1)' class='btn btn-sm btn-outline-secondary'>&gt;</button>
      </div>`;

      months.forEach((m, i) => {
        const div = document.createElement('div');
        let content = `<div class='day-header'>${m}</div>`;
        appointments.forEach(app => {
          if (appMonth === i && appYear === currentYear) {
            const cls = app.className || 'default-appointment-style';
            content += `<div class='appointment ${cls}'>${app.patientname}<br>${app.day}, ${app.appointment_time}</div>`;
          }
        });
        div.innerHTML = content;
        yearGrid.appendChild(div);
      });
    }
  </script>
</body>
</html>
